(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{3219:function(e,t){!function(e){"use strict";var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};function r(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var n=function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},n.apply(this,arguments)};function a(e,t,r,n){function a(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,s){function i(e){try{u(n.next(e))}catch(t){s(t)}}function o(e){try{u(n.throw(e))}catch(t){s(t)}}function u(e){e.done?r(e.value):a(e.value).then(i,o)}u((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(o){s=[6,o],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function i(e){var t="function"===typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e){return this instanceof o?(this.v=e,this):new o(e)}function u(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),s=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||u(e,t)}))})}function u(e,t){try{c(a[e](t))}catch(r){f(s[0][3],r)}}function c(e){e.value instanceof o?Promise.resolve(e.value.v).then(l,p):f(s[0][2],e)}function l(e){u("next",e)}function p(e){u("throw",e)}function f(e,t){e(t),s.shift(),s.length&&u(s[0][0],s[0][1])}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"===typeof i?i(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){a(n,s,(t=e[r](t)).done,t.value)}))}}function a(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}}var l=function(){function e(e,t,r){this.allowBoost=!1,this.string=e,this.marks=t,this.index=0,this.parseOptions=r}return e.prototype.hasMark=function(e){return void 0===e&&(e=0),this.index+e<this.marks.length},e.prototype.getMark=function(e){return void 0===e&&(e=0),this.marks[this.index+e]},e.prototype.shift=function(){this.index+=1},e.prototype.process=function(e){var t=this.marks[this.index];this.shift();var r=e[t.name];if(!r)throw new Error("Unknown handler: ".concat(t.name));return r.call(e,this,t)},e.prototype.processString=function(){return this.shift(),this.processStringEnd()},e.prototype.processStringEnd=function(){var e=this.marks[this.index-1],t=this.marks[this.index];return this.shift(),this.string.slice(e.position,t.position)},e.prototype.slice=function(e){var t=this.marks[this.index].position;return this.string.slice(t,t+e)},e}(),p=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function f(e){return p.test(e)?new Date(e):null}function h(e){var t=d(e.getUTCFullYear(),4),r=d(e.getUTCMonth()+1,2),n=d(e.getUTCDate(),2),a=d(e.getUTCHours(),2),s=d(e.getUTCMinutes(),2),i=d(e.getUTCSeconds(),2),o="",u=e.getMilliseconds();return 0!=u&&(o=".".concat(d(u,3))),"".concat(t,"-").concat(r,"-").concat(n,"T").concat(a,":").concat(s,":").concat(i).concat(o,"Z")}function d(e,t){for(var r=e.toString();r.length<t;)r="0".concat(r);return r}function y(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(e){for(var t=[],r=0,n=e.split(".");r<n.length;r++){var a=n[r];"*"===a?t.push("[^.]+"):"**"===a?t.push(".*"):t.push(y(a))}return new RegExp("^".concat(t.join("."),"$"))}var v=function(){function e(e){this.pattern=e,this.patternRe=b(e)}return e.prototype.matches=function(e){return this.patternRe.test(e)},e.prototype.toJSON=function(){return this.pattern},e}(),m=function(){function e(e){this.type="stream",this.generator=e,this.ticker=null,this.isDone=!1,this.data=[]}return e.prototype.isArray=function(){return!0},e.prototype.get=function(){var e,t;return a(this,void 0,void 0,(function(){var r,n,a,i,o,u,l;return s(this,(function(s){switch(s.label){case 0:r=[],s.label=1;case 1:s.trys.push([1,7,8,13]),n=c(this),s.label=2;case 2:return[4,n.next()];case 3:return(a=s.sent()).done?[3,6]:(i=a.value,u=(o=r).push,[4,i.get()]);case 4:u.apply(o,[s.sent()]),s.label=5;case 5:return[3,2];case 6:return[3,13];case 7:return l=s.sent(),e={error:l},[3,13];case 8:return s.trys.push([8,,11,12]),a&&!a.done&&(t=n.return)?[4,t.call(n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(e)throw e.error;return[7];case 12:return[7];case 13:return[2,r]}}))}))},e.prototype[Symbol.asyncIterator]=function(){return u(this,arguments,(function(){var e;return s(this,(function(t){switch(t.label){case 0:e=0,t.label=1;case 1:t.label=2;case 2:return e<this.data.length?[4,o(this.data[e])]:[3,6];case 3:return[4,t.sent()];case 4:t.sent(),t.label=5;case 5:return e++,[3,2];case 6:return this.isDone?[4,o(void 0)]:[3,8];case 7:return[2,t.sent()];case 8:return[4,o(this._nextTick())];case 9:return t.sent(),[3,1];case 10:return[2]}}))}))},e.prototype._nextTick=function(){var e,t=this;if(this.ticker)return this.ticker;var r=function(){t.ticker=new Promise((function(t){e=t}))},n=function(){e(),r()},i=function(){return a(t,void 0,void 0,(function(){var e,t,r,a,i,o;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),e=c(this.generator()),s.label=1;case 1:return[4,e.next()];case 2:if((t=s.sent()).done)return[3,4];r=t.value,this.data.push(r),n(),s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=s.sent(),i={error:a},[3,11];case 6:return s.trys.push([6,,9,10]),t&&!t.done&&(o=e.return)?[4,o.call(e)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return this.isDone=!0,n(),[2]}}))}))};return r(),i(),this.ticker},e}(),w=function(){function e(e,t){this.data=e,this.type=t}return e.prototype.isArray=function(){return"array"===this.type},e.prototype.get=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.data]}))}))},e.prototype[Symbol.asyncIterator]=function(){if(Array.isArray(this.data))return function(e){var t,r;return s(this,(function(n){switch(n.label){case 0:t=0,r=e,n.label=1;case 1:return t<r.length?[4,I(r[t])]:[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}(this.data);throw new Error("Cannot iterate over: ".concat(this.type))},e}(),g=new w(null,"null"),k=new w(!0,"boolean"),x=new w(!1,"boolean"),_=function(){function e(e){this.date=e}return e.parseToValue=function(t){var r=f(t);return r?new w(new e(r),"datetime"):g},e.prototype.equals=function(e){return this.date.getTime()==e.date.getTime()},e.prototype.add=function(t){var r=new Date(this.date.getTime());return r.setTime(r.getTime()+1e3*t),new e(r)},e.prototype.difference=function(e){return(this.date.getTime()-e.date.getTime())/1e3},e.prototype.compareTo=function(e){return this.date.getTime()-e.date.getTime()},e.prototype.toString=function(){return h(this.date)},e.prototype.toJSON=function(){return this.toString()},e}();function E(e){return Number.isFinite(e)?new w(e,"number"):g}function A(e){return new w(e,"string")}function S(e){return new w(e,"datetime")}function j(e){return new w(e,"path")}function O(e){return e&&"function"===typeof e.next}function I(e){return O(e)?new m((function(){return u(this,arguments,(function(){var t,r,n,a,i;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,13]),t=c(e),s.label=1;case 1:return[4,o(t.next())];case 2:return(r=s.sent()).done?[3,6]:[4,o(I(r.value))];case 3:return[4,s.sent()];case 4:s.sent(),s.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return n=s.sent(),a={error:n},[3,13];case 8:return s.trys.push([8,,11,12]),r&&!r.done&&(i=t.return)?[4,o(i.call(t))]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(a)throw a.error;return[7];case 12:return[7];case 13:return[2]}}))}))})):null===e||void 0===e?g:new w(e,C(e))}function C(e){return null===e||"undefined"===typeof e?"null":Array.isArray(e)?"array":e instanceof v?"path":e instanceof _?"datetime":typeof e}var T={datetime:1,number:2,string:3,boolean:4};function M(e,t){var r=C(e);if(r!==C(t))return null;switch(r){case"number":case"boolean":return e-t;case"string":return e<t?-1:e>t?1:0;case"datetime":return e.compareTo(t);default:return null}}function P(e,t){var r=C(e),n=C(t),a=T[r]||100,s=T[n]||100;if(a!==s)return a-s;var i=M(e,t);return null===i&&(i=0),i}var N=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,U=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,V=/(\b\.+|\.+\b)/g,D=1024;function F(e,t){return 0!==e.length&&0!==t.length&&t.every((function(t){return t(e)}))}function q(e){return e.replace(V,"").match(N)||[]}function G(e){return $(e).map((function(e){return function(t){return t.some((function(t){return e.test(t)}))}}))}function $(e){return(e.replace(V,"").match(U)||[]).map((function(e){return new RegExp("^".concat(e.slice(0,D).replace(/\*/g,".*"),"$"),"i")}))}function B(e,t){var r,n,i,o;return a(this,void 0,void 0,(function(){var a,u,l;return s(this,(function(s){switch(s.label){case 0:if("string"===e.type)return t(e.data),[2,!0];if(!e.isArray())return[3,13];a=!0,s.label=1;case 1:s.trys.push([1,6,7,12]),r=c(e),s.label=2;case 2:return[4,r.next()];case 3:if((n=s.sent()).done)return[3,5];"string"===(u=n.value).type?t(u.data):a=!1,s.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=s.sent(),i={error:l},[3,12];case 7:return s.trys.push([7,,10,11]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,9];case 8:s.sent(),s.label=9;case 9:return[3,11];case 10:if(i)throw i.error;return[7];case 11:return[7];case 12:return[2,a];case 13:return[2,!1]}}))}))}var H=1.2;function R(e,t,r){return a(this,void 0,void 0,(function(){var n,a,i,o,u;return s(this,(function(s){switch(s.label){case 0:return"OpCall"===e.type&&"match"===e.op?[2,Z(e.left,e.right,t,r)]:"FuncCall"!==e.type||"boost"!==e.name?[3,3]:[4,R(e.args[0],t,r)];case 1:return n=s.sent(),[4,r(e.args[1],t)];case 2:return"number"===(a=s.sent()).type&&n>0?[2,n+a.data]:[2,0];case 3:switch(e.type){case"Or":return[3,4];case"And":return[3,7]}return[3,10];case 4:case 7:return[4,R(e.left,t,r)];case 5:case 8:return i=s.sent(),[4,R(e.right,t,r)];case 6:return o=s.sent(),[2,i+o];case 9:return o=s.sent(),0===i||0===o?[2,0]:[2,i+o];case 10:return[4,r(e,t)];case 11:return[2,"boolean"===(u=s.sent()).type&&!0===u.data?1:0]}}))}))}function Z(e,t,r,n){return a(this,void 0,void 0,(function(){var a,i,o,u,c,l,p,f,h;return s(this,(function(s){switch(s.label){case 0:return[4,n(e,r)];case 1:return a=s.sent(),[4,n(t,r)];case 2:return i=s.sent(),o=[],u=[],[4,B(a,(function(e){o=o.concat(q(e))}))];case 3:return s.sent(),[4,B(i,(function(e){u=u.concat($(e))}))];case 4:if(!s.sent())return[2,0];if(0===o.length||0===u.length)return[2,0];for(c=0,l=function(e){var t=o.reduce((function(t,r){return t+(e.test(r)?1:0)}),0);c+=t*(H+1)/(t+H)},p=0,f=u;p<f.length;p++)h=f[p],l(h);return[2,c]}}))}))}function z(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return"object"!==e.type?[3,1]:[2,J(e.data)];case 1:return e.isArray()?[4,W(e)]:[3,3];case 2:if((t=r.sent()).length>0)return[2,t.join("\n\n")];r.label=3;case 3:return[2,null]}}))}))}function W(e,t){var r,n,i,o;return void 0===t&&(t=[]),a(this,void 0,void 0,(function(){var a,u,l;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,13]),r=c(e),s.label=1;case 1:return[4,r.next()];case 2:return(n=s.sent()).done?[3,6]:"object"!==(a=n.value).type?[3,3]:(null!==(u=J(a.data))&&t.push(u),[3,5]);case 3:return a.isArray()?[4,W(a,t)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return l=s.sent(),i={error:l},[3,13];case 8:return s.trys.push([8,,11,12]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(i)throw i.error;return[7];case 12:return[7];case 13:return[2,t]}}))}))}function J(e){if("string"!==typeof e._type)return null;var t=e.children;if(!Array.isArray(t))return null;for(var r="",n=0,a=t;n<a.length;n++){var s=a[n];s&&"object"===typeof s&&"string"===typeof s._type&&"span"===s._type&&"string"===typeof s.text&&(r+=s.text)}return r}function Q(e,t){switch(C(e)){case"array":for(var r=0,n=e;r<n.length;r++)if(Q(n[r],t))return!0;break;case"object":if(e._ref)return t.has(e._ref);for(var a=0,s=Object.values(e);a<s.length;a++)if(Q(s[a],t))return!0}return!1}function L(e){for(var t=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);n>=55296&&n<=56319||t++}return t}var Y={anywhere:function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){throw new Error("not implemented")}))}))}};Y.anywhere.arity=1,Y.coalesce=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a,i,o;return s(this,(function(s){switch(s.label){case 0:n=0,a=e,s.label=1;case 1:return n<a.length?(i=a[n],[4,r(i,t)]):[3,4];case 2:if("null"!==(o=s.sent()).type)return[2,o];s.label=3;case 3:return n++,[3,1];case 4:return[2,g]}}))}))},Y.count=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if(!(a=s.sent()).isArray())return[2,g];o=0,s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(a),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];l.value,o++,s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return p=s.sent(),n={error:p},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,E(o)]}}))}))},Y.count.arity=1,Y.dateTime=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return"datetime"===(n=a.sent()).type?[2,n]:"string"!==n.type?[2,g]:[2,_.parseToValue(n.data)]}}))}))},Y.dateTime.arity=1,Y.defined=function(e,t,r){return a(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,r(e[0],t)];case 1:return[2,"null"===n.sent().type?x:k]}}))}))},Y.defined.arity=1,Y.identity=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,A(t.context.identity)]}))}))},Y.identity.arity=0,Y.length=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if("string"===(a=s.sent()).type)return[2,E(L(a.data))];if(!a.isArray())return[3,14];o=0,s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(a),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];l.value,o++,s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return p=s.sent(),n={error:p},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,E(o)];case 14:return[2,g]}}))}))},Y.length.arity=1,Y.path=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return"string"!==(n=a.sent()).type?[2,g]:[2,j(new v(n.data))]}}))}))},Y.path.arity=1,Y.string=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:switch((n=a.sent()).type){case"number":case"string":case"boolean":case"datetime":return[2,A("".concat(n.data))];default:return[2,g]}return[2]}}))}))},Y.string.arity=1,Y.references=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f,h,d,y;return s(this,(function(s){switch(s.label){case 0:a=new Set,o=0,u=e,s.label=1;case 1:return o<u.length?(l=u[o],[4,r(l,t)]):[3,16];case 2:return"string"!==(p=s.sent()).type?[3,3]:(a.add(p.data),[3,15]);case 3:if(!p.isArray())return[3,15];s.label=4;case 4:s.trys.push([4,9,10,15]),n=void 0,f=c(p),s.label=5;case 5:return[4,f.next()];case 6:if((h=s.sent()).done)return[3,8];"string"===(d=h.value).type&&a.add(d.data),s.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return y=s.sent(),n={error:y},[3,15];case 10:return s.trys.push([10,,13,14]),h&&!h.done&&(i=f.return)?[4,i.call(f)]:[3,12];case 11:s.sent(),s.label=12;case 12:return[3,14];case 13:if(n)throw n.error;return[7];case 14:return[7];case 15:return o++,[3,1];case 16:return 0===a.size?[2,x]:[4,t.value.get()];case 17:return[2,Q(s.sent(),a)?k:x]}}))}))},Y.references.arity=function(e){return e>=1},Y.round=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a,i,o;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:return"number"!==(n=s.sent()).type?[2,g]:(a=n.data,i=0,2!==e.length?[3,3]:[4,r(e[1],t)]);case 2:if("number"!==(o=s.sent()).type||o.data<0||!Number.isInteger(o.data))return[2,g];i=o.data,s.label=3;case 3:return 0===i?a<0?[2,E(-Math.round(-a))]:[2,E(Math.round(a))]:[2,E(Number(a.toFixed(i)))]}}))}))},Y.round.arity=function(e){return e>=1&&e<=2},Y.now=function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,A(t.context.timestamp.toISOString())]}))}))},Y.now.arity=0,Y.boost=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){throw new Error("unexpected boost call")}))}))},Y.boost.arity=2;var K={lower:function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return"string"!==(n=a.sent()).type?[2,g]:[2,A(n.data.toLowerCase())]}}))}))}};K.lower.arity=1,K.upper=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return"string"!==(n=a.sent()).type?[2,g]:[2,A(n.data.toUpperCase())]}}))}))},K.upper.arity=1,K.split=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:return"string"!==(n=s.sent()).type?[2,g]:[4,r(e[1],t)];case 2:return"string"!==(a=s.sent()).type?[2,g]:0===n.data.length?[2,I([])]:0===a.data.length?[2,I(Array.from(n.data))]:[2,I(n.data.split(a.data))]}}))}))},K.split.arity=2,Y.lower=K.lower,Y.upper=K.upper,K.startsWith=function(e,t,r){return a(this,void 0,void 0,(function(){var n,a;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:return"string"!==(n=s.sent()).type?[2,g]:[4,r(e[1],t)];case 2:return"string"!==(a=s.sent()).type?[2,g]:[2,n.data.startsWith(a.data)?k:x]}}))}))},K.startsWith.arity=2;var X={join:function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f,h,d;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:return(a=s.sent()).isArray()?[4,r(e[1],t)]:[2,g];case 2:if("string"!==(o=s.sent()).type)return[2,g];u="",l=!1,s.label=3;case 3:s.trys.push([3,8,9,14]),p=c(a),s.label=4;case 4:return[4,p.next()];case 5:if((f=s.sent()).done)return[3,7];switch(h=f.value,l&&(u+=o.data),h.type){case"number":case"string":case"boolean":case"datetime":u+="".concat(h.data);break;default:return[2,g]}l=!0,s.label=6;case 6:return[3,4];case 7:return[3,14];case 8:return d=s.sent(),n={error:d},[3,14];case 9:return s.trys.push([9,,12,13]),f&&!f.done&&(i=p.return)?[4,i.call(p)]:[3,11];case 10:s.sent(),s.label=11;case 11:return[3,13];case 12:if(n)throw n.error;return[7];case 13:return[7];case 14:return[2,I(u)]}}))}))}};X.join.arity=2,X.compact=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return(n=a.sent()).isArray()?[2,new m((function(){return u(this,arguments,(function(){var e,t,r,a,i,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,13]),e=c(n),s.label=1;case 1:return[4,o(e.next())];case 2:return(t=s.sent()).done?[3,6]:"null"===(r=t.value).type?[3,5]:[4,o(r)];case 3:return[4,s.sent()];case 4:s.sent(),s.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return a=s.sent(),i={error:a},[3,13];case 8:return s.trys.push([8,,11,12]),t&&!t.done&&(u=e.return)?[4,o(u.call(e))]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(i)throw i.error;return[7];case 12:return[7];case 13:return[2]}}))}))}))]:[2,g]}}))}))},X.compact.arity=1,X.unique=function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return(n=a.sent()).isArray()?[2,new m((function(){return u(this,arguments,(function(){var e,t,r,a,i,u,l;return s(this,(function(s){switch(s.label){case 0:e=new Set,s.label=1;case 1:s.trys.push([1,13,14,19]),t=c(n),s.label=2;case 2:return[4,o(t.next())];case 3:if((r=s.sent()).done)return[3,12];switch((a=r.value).type){case"number":case"string":case"boolean":case"datetime":return[3,4]}return[3,8];case 4:return e.has(a.data)?[3,7]:(e.add(a.data),[4,o(a)]);case 5:return[4,s.sent()];case 6:s.sent(),s.label=7;case 7:return[3,11];case 8:return[4,o(a)];case 9:return[4,s.sent()];case 10:s.sent(),s.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return i=s.sent(),u={error:i},[3,19];case 14:return s.trys.push([14,,17,18]),r&&!r.done&&(l=t.return)?[4,o(l.call(t))]:[3,16];case 15:s.sent(),s.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}}))}))}))]:[2,g]}}))}))},X.unique.arity=1;var ee={text:function(e,t,r){return a(this,void 0,void 0,(function(){var n;return s(this,(function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return[4,z(a.sent())];case 2:return null===(n=a.sent())?[2,g]:[2,A(n)]}}))}))}};ee.text.arity=1;var te={projectId:function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return t.context.sanity?[2,A(t.context.sanity.projectId)]:[2,g]}))}))},dataset:function(e,t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return t.context.sanity?[2,A(t.context.sanity.dataset)]:[2,g]}))}))}},re={order:function(e,t,r,n){var i,o,u,l;return a(this,void 0,void 0,(function(){var a,p,f,h,d,y,b,v,m,w,k,x,_,E,A,S,j;return s(this,(function(s){switch(s.label){case 0:return[4,!0];case 1:if(s.sent(),!e.isArray())return[2,g];for(a=[],p=[],f=0,h=0,d=t;h<d.length;h++)y=d[h],b="asc","Desc"===y.type?(b="desc",y=y.base):"Asc"===y.type&&(y=y.base),a.push(y),p.push(b),f++;v=[],m=0,s.label=2;case 2:s.trys.push([2,13,14,19]),i=c(e),s.label=3;case 3:return[4,i.next()];case 4:return(o=s.sent()).done?[3,12]:(w=o.value,k=r.createNested(w),[4,w.get()]);case 5:x=[s.sent(),m],_=0,s.label=6;case 6:return _<f?[4,n(a[_],k)]:[3,10];case 7:return E=s.sent(),S=(A=x).push,[4,E.get()];case 8:S.apply(A,[s.sent()]),s.label=9;case 9:return _++,[3,6];case 10:v.push(x),m++,s.label=11;case 11:return[3,3];case 12:return[3,19];case 13:return j=s.sent(),u={error:j},[3,19];case 14:return s.trys.push([14,,17,18]),o&&!o.done&&(l=i.return)?[4,l.call(i)]:[3,16];case 15:s.sent(),s.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return v.sort((function(e,t){for(var r=0;r<f;r++){var n=P(e[r+2],t[r+2]);if("desc"===p[r]&&(n=-n),0!==n)return n}return e[1]-t[1]})),[2,I(v.map((function(e){return e[0]})))]}}))}))}};re.order.arity=function(e){return e>=1},re.score=function(e,t,r,n){var i,o,u,l;return a(this,void 0,void 0,(function(){var a,p,f,h,d,y,b,v,m,w,k,x,_;return s(this,(function(s){switch(s.label){case 0:if(!e.isArray())return[2,g];a=[],p=[],s.label=1;case 1:s.trys.push([1,12,13,18]),i=c(e),s.label=2;case 2:return[4,i.next()];case 3:return(o=s.sent()).done?[3,11]:"object"===(f=o.value).type?[3,5]:(d=(h=a).push,[4,f.get()]);case 4:return d.apply(h,[s.sent()]),[3,10];case 5:y=r.createNested(f),b="number"===typeof f.data._score?f.data._score:0,v=0,m=t,s.label=6;case 6:return v<m.length?(w=m[v],k=b,[4,R(w,y,n)]):[3,9];case 7:b=k+s.sent(),s.label=8;case 8:return v++,[3,6];case 9:x=Object.assign({},f.data,{_score:b}),p.push(x),s.label=10;case 10:return[3,2];case 11:return[3,18];case 12:return _=s.sent(),u={error:_},[3,18];case 13:return s.trys.push([13,,16,17]),o&&!o.done&&(l=i.return)?[4,l.call(i)]:[3,15];case 14:s.sent(),s.label=15;case 15:return[3,17];case 16:if(u)throw u.error;return[7];case 17:return[7];case 18:return p.sort((function(e,t){return t._score-e._score})),[2,I(p)]}}))}))},re.score.arity=function(e){return e>=1};var ne={operation:function(e,t){return a(this,void 0,void 0,(function(){var e,r;return s(this,(function(n){return e=null!==t.context.before,r=null!==t.context.after,e&&r?[2,A("update")]:r?[2,A("create")]:e?[2,A("delete")]:[2,g]}))}))},changedAny:function(){throw new Error("not implemented")}};ne.changedAny.arity=1,ne.changedAny.mode="delta",ne.changedOnly=function(){throw new Error("not implemented")},ne.changedOnly.arity=1,ne.changedOnly.mode="delta";var ae={changedAny:function(){throw new Error("not implemented")}};ae.changedAny.arity=3,ae.changedOnly=function(){throw new Error("not implemented")},ae.changedOnly.arity=3;var se={min:function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if(!(a=s.sent()).isArray())return[2,g];o=void 0,s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(a),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];if("null"===(p=l.value).type)return[3,5];if("number"!==p.type)return[2,g];(void 0===o||p.data<o)&&(o=p.data),s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return f=s.sent(),n={error:f},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,I(o)]}}))}))}};se.min.arity=1,se.max=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if(!(a=s.sent()).isArray())return[2,g];o=void 0,s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(a),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];if("null"===(p=l.value).type)return[3,5];if("number"!==p.type)return[2,g];(void 0===o||p.data>o)&&(o=p.data),s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return f=s.sent(),n={error:f},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,I(o)]}}))}))},se.max.arity=1,se.sum=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if(!(a=s.sent()).isArray())return[2,g];o=0,s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(a),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];if("null"===(p=l.value).type)return[3,5];if("number"!==p.type)return[2,g];o+=p.data,s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return f=s.sent(),n={error:f},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,I(o)]}}))}))},se.sum.arity=1,se.avg=function(e,t,r){var n,i;return a(this,void 0,void 0,(function(){var a,o,u,l,p,f,h;return s(this,(function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if(!(a=s.sent()).isArray())return[2,g];o=0,u=0,s.label=2;case 2:s.trys.push([2,7,8,13]),l=c(a),s.label=3;case 3:return[4,l.next()];case 4:if((p=s.sent()).done)return[3,6];if("null"===(f=p.value).type)return[3,5];if("number"!==f.type)return[2,g];o+=f.data,u++,s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return h=s.sent(),n={error:h},[3,13];case 8:return s.trys.push([8,,11,12]),p&&!p.done&&(i=l.return)?[4,i.call(l)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return 0===u?[2,g]:[2,I(o/u)]}}))}))},se.avg.arity=1;var ie={global:Y,string:K,array:X,pt:ee,delta:ne,diff:ae,sanity:te,math:se};const oe=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,ue=/^\d+/,ce=/^[a-zA-Z_][a-zA-Z_0-9]*/,le=1,pe=2,fe=3,he=4,de=4,ye=6,be=6,ve=7,me=7,we=7,ge=8,ke=10,xe=10,_e=8;function Ee(e){let t=0;t=Ce(e,t);let r=Ae(e,t,0);return"error"===r.type?r:(t=Ce(e,r.position),t!==e.length?(r.failPosition&&(t=r.failPosition-1),{type:"error",position:t}):(delete r.position,delete r.failPosition,r))}function Ae(e,t,r){let n,a=t;switch(e[t]){case"+":{let r=Ae(e,Ce(e,t+1),ke);if("error"===r.type)return r;n=[{name:"pos",position:a}].concat(r.marks),t=r.position;break}case"-":{let r=Ae(e,Ce(e,t+1),_e);if("error"===r.type)return r;n=[{name:"neg",position:a}].concat(r.marks),t=r.position;break}case"(":{let r=Ae(e,Ce(e,t+1),0);if("error"===r.type)return r;switch(e[t=Ce(e,r.position)]){case",":for(n=[{name:"tuple",position:a}].concat(r.marks),t=Ce(e,t+1);;){if(r=Ae(e,t,0),"error"===r.type)return r;if(","!==e[t=Ce(e,r.position)])break;t=Ce(e,t+1)}if(")"!==e[t])return{type:"error",position:t};t++,n.push({name:"tuple_end",position:t});break;case")":t++,n=[{name:"group",position:a}].concat(r.marks);break;default:return{type:"error",position:t}}break}case"!":{let r=Ae(e,Ce(e,t+1),xe);if("error"===r.type)return r;n=[{name:"not",position:a}].concat(r.marks),t=r.position;break}case"{":{let r=Oe(e,t);if("error"===r.type)return r;n=r.marks,t=r.position;break}case"[":if(n=[{name:"array",position:t}],"]"!==e[t=Ce(e,t+1)])for(;;){"..."===e.slice(t,t+3)&&(n.push({name:"array_splat",position:t}),t=Ce(e,t+3));let r=Ae(e,t,0);if("error"===r.type)return r;if(n=n.concat(r.marks),","!==e[t=Ce(e,t=r.position)])break;if("]"===e[t=Ce(e,t+1)])break}if("]"!==e[t])return{type:"error",position:t};t++,n.push({name:"array_end",position:t});break;case"'":case'"':{let r=Ie(e,t);if("error"===r.type)return r;n=r.marks,t=r.position;break}case"^":for(t++,n=[];"."===e[t]&&"^"===e[t+1];)n.push({name:"dblparent",position:a}),t+=2;n.push({name:"parent",position:a});break;case"@":n=[{name:"this",position:a}],t++;break;case"*":n=[{name:"everything",position:a}],t++;break;case"$":{let r=Te(e,t+1,ce);r&&(n=[{name:"param",position:a},{name:"ident",position:a+1},{name:"ident_end",position:t+=1+r}]);break}default:{let r=Te(e,t,ue);if(r){let s="integer";if("."===e[t+=r]){let r=Te(e,t+1,ue);r&&(s="float",t+=1+r)}if("e"===e[t]||"E"===e[t]){s="sci","+"!==e[++t]&&"-"!==e[t]||t++;let r=Te(e,t,ue);if(!r)return{type:"error",position:t};t+=r}n=[{name:s,position:a},{name:s+"_end",position:t}];break}let s=Te(e,t,ce);if(s){switch(e[t+=s]){case":":case"(":{let r=je(e,a,t);if("error"===r.type)return r;n=r.marks,t=r.position;break}default:n=[{name:"this_attr",position:a},{name:"ident",position:a},{name:"ident_end",position:t}]}break}}}if(!n)return{type:"error",position:t};let s,i=12;e:for(;;){let o=Ce(e,t);if(o===e.length){t=o;break}if(s=Se(e,o),"success"!==s.type)switch(e[o]){case"=":switch(e[o+1]){case">":{if(r>le||i<=le)break e;let s=Ae(e,Ce(e,o+2),le);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"pair",position:a}),t=s.position,i=le;break}case"=":{if(r>he||i<=he)break e;let s=Ae(e,Ce(e,o+2),5);if("error"===s.type)return s;n.unshift({name:"comp",position:a}),n.push({name:"op",position:o},{name:"op_end",position:o+2}),n=n.concat(s.marks),t=s.position,i=he;break}default:break e}break;case"+":{if(r>ye||i<ye)break e;let s=Ae(e,Ce(e,o+1),ye+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"add",position:a}),t=s.position,i=ye;break}case"-":{if(r>be||i<be)break e;let s=Ae(e,Ce(e,o+1),be+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"sub",position:a}),t=s.position,i=be;break}case"*":{if("*"===e[o+1]){if(r>ge||i<=ge)break e;let s=Ae(e,Ce(e,o+2),ge);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"pow",position:a}),t=s.position,i=ge;break}if(r>ve||i<ve)break e;let s=Ae(e,Ce(e,o+1),ve+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"mul",position:a}),t=s.position,i=ve;break}case"/":{if(r>me||i<me)break e;let s=Ae(e,Ce(e,o+1),me+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"div",position:a}),t=s.position,i=me;break}case"%":{if(r>we||i<we)break e;let s=Ae(e,Ce(e,o+1),we+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"mod",position:a}),t=s.position,i=we;break}case"<":case">":{if(r>he||i<=he)break e;let s=o+1;"="===e[s]&&s++;let u=Ae(e,Ce(e,s),he+1);if("error"===u.type)return u;n.unshift({name:"comp",position:a}),n.push({name:"op",position:o},{name:"op_end",position:s}),n=n.concat(u.marks),t=u.position,i=he;break}case"|":if("|"===e[o+1]){if(r>pe||i<pe)break e;let s=Ae(e,Ce(e,o+2),pe+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"or",position:a}),t=s.position,i=pe}else{if(r>11||i<11)break e;let s=Ce(e,o+1),u=Te(e,s,ce);if(!u)return{type:"error",position:s};if("("===e[t=s+u]||":"===e[t]){let r=je(e,s,t);if("error"===r.type)return r;n=n.concat(r.marks),n.unshift({name:"pipecall",position:a}),t=r.position,i=11}}break;case"&":{if("&"!=e[o+1])break e;if(r>fe||i<fe)break e;let s=Ae(e,Ce(e,o+2),fe+1);if("error"===s.type)return s;n=n.concat(s.marks),n.unshift({name:"and",position:a}),t=s.position,i=fe;break}case"!":{if("="!==e[o+1])break e;if(r>he||i<he)break e;let s=Ae(e,Ce(e,o+2),he+1);if("error"===s.type)return s;n.unshift({name:"comp",position:a}),n.push({name:"op",position:o},{name:"op_end",position:o+2}),n=n.concat(s.marks),t=s.position,i=he;break}case"d":if("desc"!==e.slice(o,o+4))break e;if(r>de||i<de)break e;n.unshift({name:"desc",position:a}),t=o+4,i=de;break;case"a":if("asc"!==e.slice(o,o+3))break e;if(r>de||i<de)break e;n.unshift({name:"asc",position:a}),t=o+3,i=de;break;default:switch(Me(e,o,ce)){case"in":{if(r>he||i<=he)break e;let s=!1;"("===e[t=Ce(e,o+2)]&&(s=!0,t=Ce(e,t+1));let u=t,c=Ae(e,t,he+1);if("error"===c.type)return c;if("."===e[t=Ce(e,c.position)]&&"."===e[t+1]){let r="inc_range";"."===e[t+2]?(r="exc_range",t=Ce(e,t+3)):t=Ce(e,t+2);let s=Ae(e,t,he+1);if("error"===s.type)return s;n.unshift({name:"in_range",position:a}),n=n.concat({name:r,position:u},c.marks,s.marks),t=s.position}else n.unshift({name:"comp",position:a}),n.push({name:"op",position:o},{name:"op_end",position:o+2}),n=n.concat(c.marks);if(s){if(")"!==e[t=Ce(e,t)])return{type:"error",position:t};t++}i=he;break}case"match":{if(r>he||i<=he)break e;let s=Ae(e,Ce(e,o+5),he+1);if("error"===s.type)return s;n.unshift({name:"comp",position:a}),n.push({name:"op",position:o},{name:"op_end",position:o+5}),n=n.concat(s.marks),t=s.position,i=4;break}default:break e}}else{for(n.unshift({name:"traverse",position:a});"success"===s.type;)n=n.concat(s.marks),s=Se(e,Ce(e,t=s.position));n.push({name:"traversal_end",position:t})}}return{type:"success",marks:n,position:t,failPosition:"error"===s?.type&&s.position}}function Se(e,t){let r=t;switch(e[t]){case".":{let n=t=Ce(e,t+1),a=Te(e,t,ce);return a?{type:"success",marks:[{name:"attr_access",position:r},{name:"ident",position:n},{name:"ident_end",position:t+=a}],position:t}:{type:"error",position:t}}case"-":if(">"!==e[t+1])return{type:"error",position:t};let n=[{name:"deref",position:r}],a=Ce(e,t+=2),s=Te(e,a,ce);return s&&(t=a+s,n.push({name:"deref_attr",position:a},{name:"ident",position:a},{name:"ident_end",position:t})),{type:"success",marks:n,position:t};case"[":{if("]"===e[t=Ce(e,t+1)])return{type:"success",marks:[{name:"array_postfix",position:r}],position:t+1};let n=t,a=Ae(e,t,0);if("error"===a.type)return a;if("."===e[t=Ce(e,a.position)]&&"."===e[t+1]){let s="inc_range";"."===e[t+2]?(s="exc_range",t+=3):t+=2;let i=Ae(e,t=Ce(e,t),0);return"error"===i.type?i:"]"!==e[t=Ce(e,i.position)]?{type:"error",position:t}:{type:"success",marks:[{name:"slice",position:r},{name:s,position:n}].concat(a.marks,i.marks),position:t+1}}return"]"!==e[t]?{type:"error",position:t}:{type:"success",marks:[{name:"square_bracket",position:r}].concat(a.marks),position:t+1}}case"|":if("{"===e[t=Ce(e,t+1)]){let n=Oe(e,t);return"error"===n.type||n.marks.unshift({name:"projection",position:r}),n}break;case"{":{let n=Oe(e,t);return"error"===n.type||n.marks.unshift({name:"projection",position:r}),n}}return{type:"error",position:t}}function je(e,t,r){let n=[];if(n.push({name:"func_call",position:t}),":"===e[r]&&":"===e[r+1]){n.push({name:"namespace",position:t}),n.push({name:"ident",position:t},{name:"ident_end",position:r});let a=Te(e,r=Ce(e,r+2),ce);if(!a)return{type:"error",position:r};if(n.push({name:"ident",position:r},{name:"ident_end",position:r+a}),"("!==e[r=Ce(e,r+a)])return{type:"error",position:r};r++}else n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=Ce(e,r+1);let a=r;if(")"!==e[r])for(;;){let t=Ae(e,r,0);if("error"===t.type)return t;if(n=n.concat(t.marks),a=t.position,","!==e[r=Ce(e,t.position)])break;if(")"===e[r=Ce(e,r+1)])break}return")"!==e[r]?{type:"error",position:r}:(n.push({name:"func_args_end",position:a}),{type:"success",marks:n,position:r+1})}function Oe(e,t){let r=[{name:"object",position:t}];for(t=Ce(e,t+1);"}"!==e[t];){let n=t;if("..."===e.slice(t,t+3))if("}"!==e[t=Ce(e,t+3)]&&","!==e[t]){let a=Ae(e,t,0);if("error"===a.type)return a;r.push({name:"object_splat",position:n}),r=r.concat(a.marks),t=a.position}else r.push({name:"object_splat_this",position:n});else{let a=Ae(e,t,0);if("error"===a.type)return a;let s=Ce(e,a.position);if("str"===a.marks[0].name&&":"===e[s]){let i=Ae(e,Ce(e,s+1),0);if("error"===i.type)return i;r.push({name:"object_pair",position:n}),r=r.concat(a.marks,i.marks),t=i.position}else r=r.concat({name:"object_expr",position:t},a.marks),t=a.position}if(","!==e[t=Ce(e,t)])break;t=Ce(e,t+1)}return"}"!==e[t]?{type:"error",position:t}:(t++,r.push({name:"object_end",position:t}),{type:"success",marks:r,position:t})}function Ie(e,t){let r=e[t];const n=[{name:"str",position:t+=1}];e:for(;;t++){if(t>e.length)return{type:"error",position:t};switch(e[t]){case r:n.push({name:"str_end",position:t}),t++;break e;case"\\":n.push({name:"str_pause",position:t}),"u"===e[t+1]?"{"===e[t+2]?(n.push({name:"unicode_hex",position:t+3}),t=e.indexOf("}",t+3),n.push({name:"unicode_hex_end",position:t})):(n.push({name:"unicode_hex",position:t+2}),n.push({name:"unicode_hex_end",position:t+6}),t+=5):(n.push({name:"single_escape",position:t+1}),t+=1),n.push({name:"str_start",position:t+1})}}return{type:"success",marks:n,position:t}}function Ce(e,t){return t+Te(e,t,oe)}function Te(e,t,r){let n=r.exec(e.slice(t));return n?n[0].length:0}function Me(e,t,r){let n=r.exec(e.slice(t));return n?n[0]:null}function Pe(e,t){return function(r){return t(e(r))}}function Ne(e){return function(t){return{type:"Map",base:t,expr:e({type:"This"})}}}function Ue(e){return function(t){return{type:"FlatMap",base:t,expr:e({type:"This"})}}}function Ve(e,t){if(!t)return{type:"a-a",build:e};switch(t.type){case"a-a":return{type:"a-a",build:Pe(e,t.build)};case"a-b":return{type:"a-b",build:Pe(e,t.build)};case"b-b":return{type:"a-a",build:Pe(e,Ne(t.build))};case"b-a":return{type:"a-a",build:Pe(e,Ue(t.build))};default:throw new Error("unknown type: ".concat(t.type))}}function De(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"b-a",build:Pe(e,t.build)};case"a-b":case"b-b":return{type:"b-b",build:Pe(e,t.build)};default:throw new Error("unknown type: ".concat(t.type))}}function Fe(e,t){if(!t)return{type:"a-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"a-a",build:Pe(e,t.build)};case"a-b":case"b-b":return{type:"a-b",build:Pe(e,t.build)};default:throw new Error("unknown type: ".concat(t.type))}}function qe(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":return{type:"a-a",build:Pe(Ne(e),t.build)};case"a-b":return{type:"a-b",build:Pe(Ne(e),t.build)};case"b-a":return{type:"b-a",build:Pe(e,t.build)};case"b-b":return{type:"b-b",build:Pe(e,t.build)};default:throw new Error("unknown type: ".concat(t.type))}}var Ge=$e;function $e(e,t){return"string"===e.type&&"string"===t.type||"boolean"===e.type&&"boolean"===t.type||"null"===e.type&&"null"===t.type||"number"===e.type&&"number"===t.type?e.data===t.data:"datetime"===e.type&&"datetime"===t.type&&e.data.equals(t.data)}var Be={"==":function(e,t){return Ge(e,t)?k:x},"!=":function(e,t){return Ge(e,t)?x:k},">":function(e,t){if("stream"===e.type||"stream"===t.type)return g;var r=M(e.data,t.data);return null===r?g:r>0?k:x},">=":function(e,t){if("stream"===e.type||"stream"===t.type)return g;var r=M(e.data,t.data);return null===r?g:r>=0?k:x},"<":function(e,t){if("stream"===e.type||"stream"===t.type)return g;var r=M(e.data,t.data);return null===r?g:r<0?k:x},"<=":function(e,t){if("stream"===e.type||"stream"===t.type)return g;var r=M(e.data,t.data);return null===r?g:r<=0?k:x},in:function(e,t){var r,n,i,o;return a(this,void 0,void 0,(function(){var a,u;return s(this,(function(s){switch(s.label){case 0:if("path"===t.type)return"string"!==e.type?[2,g]:[2,t.data.matches(e.data)?k:x];if(!t.isArray())return[3,13];s.label=1;case 1:s.trys.push([1,6,7,12]),r=c(t),s.label=2;case 2:return[4,r.next()];case 3:if((n=s.sent()).done)return[3,5];if(a=n.value,Ge(e,a))return[2,k];s.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return u=s.sent(),i={error:u},[3,12];case 7:return s.trys.push([7,,10,11]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,9];case 8:s.sent(),s.label=9;case 9:return[3,11];case 10:if(i)throw i.error;return[7];case 11:return[7];case 12:return[2,x];case 13:return[2,g]}}))}))},match:function(e,t){return a(this,void 0,void 0,(function(){var r,n;return s(this,(function(a){switch(a.label){case 0:return r=[],n=[],[4,B(e,(function(e){r=r.concat(q(e))}))];case 1:return a.sent(),[4,B(t,(function(e){n=n.concat(G(e))}))];case 2:return a.sent()?[2,F(r,n)?k:x]:[2,x]}}))}))},"+":function(e,t){return"datetime"===e.type&&"number"===t.type?S(e.data.add(t.data)):"number"===e.type&&"number"===t.type?E(e.data+t.data):"string"===e.type&&"string"===t.type?A(e.data+t.data):"object"===e.type&&"object"===t.type?I(n(n({},e.data),t.data)):"array"===e.type&&"array"===t.type?I(e.data.concat(t.data)):e.isArray()&&t.isArray()?new m((function(){return u(this,arguments,(function(){var r,n,a,i,u,l,p,f,h,d;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,7,8,13]),r=c(e),s.label=1;case 1:return[4,o(r.next())];case 2:return(n=s.sent()).done?[3,6]:[4,o(n.value)];case 3:return[4,s.sent()];case 4:s.sent(),s.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return a=s.sent(),p={error:a},[3,13];case 8:return s.trys.push([8,,11,12]),n&&!n.done&&(f=r.return)?[4,o(f.call(r))]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(p)throw p.error;return[7];case 12:return[7];case 13:s.trys.push([13,20,21,26]),i=c(t),s.label=14;case 14:return[4,o(i.next())];case 15:return(u=s.sent()).done?[3,19]:[4,o(u.value)];case 16:return[4,s.sent()];case 17:s.sent(),s.label=18;case 18:return[3,14];case 19:return[3,26];case 20:return l=s.sent(),h={error:l},[3,26];case 21:return s.trys.push([21,,24,25]),u&&!u.done&&(d=i.return)?[4,o(d.call(i))]:[3,23];case 22:s.sent(),s.label=23;case 23:return[3,25];case 24:if(h)throw h.error;return[7];case 25:return[7];case 26:return[2]}}))}))})):g},"-":function(e,t){return"datetime"===e.type&&"number"===t.type?S(e.data.add(-t.data)):"datetime"===e.type&&"datetime"===t.type?E(e.data.difference(t.data)):"number"===e.type&&"number"===t.type?E(e.data-t.data):g},"*":He((function(e,t){return e*t})),"/":He((function(e,t){return e/t})),"%":He((function(e,t){return e%t})),"**":He((function(e,t){return Math.pow(e,t)}))};function He(e){return function(t,r){return"number"===t.type&&"number"===r.type?E(e(t.data,r.data)):g}}var Re=function(){function e(e,t,r,n,a){this.isHidden=!1,this.params=e,this.source=t,this.value=r,this.context=n,this.parent=a}return e.prototype.createNested=function(t){return this.isHidden?new e(this.params,this.source,t,this.context,this.parent):new e(this.params,this.source,t,this.context,this)},e.prototype.createHidden=function(e){var t=this.createNested(e);return t.isHidden=!0,t},e}();function Ze(e,t,r){return void 0===r&&(r=Ze),(0,We[e.type])(e,t,r)}function ze(e,t){return"then"in e?e.then(t):t(e)}var We={This:function(e,t){return t.value},Selector:function(){throw new Error("Selectors can not be evaluated")},Everything:function(e,t){return t.source},Parameter:function(e,t){var r=e.name;return I(t.params[r])},Context:function(e,t){var r=e.key;if("before"===r||"after"===r)return t.context[r]||g;throw new Error("unknown context key: ".concat(r))},Parent:function(e,t){for(var r=e.n,n=t,a=0;a<r;a++){if(!n.parent)return g;n=n.parent}return n.value},OpCall:function(e,t,r){var n=this,i=e.op,o=e.left,u=e.right,c=Be[i];if(!c)throw new Error("Unknown operator: ".concat(i));var l=r(o,t),p=r(u,t);return"then"in l||"then"in p?a(n,void 0,void 0,(function(){var e,t;return s(this,(function(r){switch(r.label){case 0:return e=c,[4,l];case 1:return t=[r.sent()],[4,p];case 2:return[2,e.apply(void 0,t.concat([r.sent()]))]}}))})):c(l,p)},Select:function(e,t,r){var n=e.alternatives,i=e.fallback;return a(this,void 0,void 0,(function(){var e,a,o,u;return s(this,(function(s){switch(s.label){case 0:e=0,a=n,s.label=1;case 1:return e<a.length?(o=a[e],[4,r(o.condition,t)]):[3,4];case 2:if("boolean"===(u=s.sent()).type&&!0===u.data)return[2,r(o.value,t)];s.label=3;case 3:return e++,[3,1];case 4:return i?[2,r(i,t)]:[2,g]}}))}))},InRange:function(e,t,r){var n=e.base,i=e.left,o=e.right,u=e.isInclusive;return a(this,void 0,void 0,(function(){var e,a,c,l,p,f,h,d,y;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return e=s.sent(),[4,r(i,t)];case 2:return a=s.sent(),[4,r(o,t)];case 3:return c=s.sent(),p=M,[4,e.get()];case 4:return f=[s.sent()],[4,a.get()];case 5:return null===(l=p.apply(void 0,f.concat([s.sent()])))?[2,g]:(d=M,[4,e.get()]);case 6:return y=[s.sent()],[4,c.get()];case 7:return null===(h=d.apply(void 0,y.concat([s.sent()])))?[2,g]:u?[2,l>=0&&h<=0?k:x]:[2,l>=0&&h<0?k:x]}}))}))},Filter:function(e,t,r){var n=e.base,i=e.expr;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return(e=a.sent()).isArray()?[2,new m((function(){return u(this,arguments,(function(){var n,a,u,l,p,f,h,d;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,8,9,14]),n=c(e),s.label=1;case 1:return[4,o(n.next())];case 2:return(a=s.sent()).done?[3,7]:(u=a.value,l=t.createNested(u),[4,o(r(i,l))]);case 3:return"boolean"!==(p=s.sent()).type||!0!==p.data?[3,6]:[4,o(u)];case 4:return[4,s.sent()];case 5:s.sent(),s.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return f=s.sent(),h={error:f},[3,14];case 9:return s.trys.push([9,,12,13]),a&&!a.done&&(d=n.return)?[4,o(d.call(n))]:[3,11];case 10:s.sent(),s.label=11;case 11:return[3,13];case 12:if(h)throw h.error;return[7];case 13:return[7];case 14:return[2]}}))}))}))]:[2,g]}}))}))},Projection:function(e,t,r){var n=e.base,i=e.expr;return a(this,void 0,void 0,(function(){var e,a;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return"object"!==(e=s.sent()).type?[2,g]:(a=t.createNested(e),[2,r(i,a)])}}))}))},FuncCall:function(e,t,r){return(0,e.func)(e.args,t,r)},PipeFuncCall:function(e,t,r){var n=e.func,i=e.base,o=e.args;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(i,t)];case 1:return e=a.sent(),[2,n(e,o,t,r)]}}))}))},AccessAttribute:function(e,t,r){var n=e.base,i=e.name;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return e=t.value,n?[4,r(n,t)]:[3,2];case 1:e=a.sent(),a.label=2;case 2:return"object"===e.type&&e.data.hasOwnProperty(i)?[2,I(e.data[i])]:[2,g]}}))}))},AccessElement:function(e,t,r){var n=e.base,i=e.index;return a(this,void 0,void 0,(function(){var e,a,o;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return(e=s.sent()).isArray()?[4,e.get()]:[2,g];case 2:return a=s.sent(),o=i<0?i+a.length:i,[2,I(a[o])]}}))}))},Slice:function(e,t,r){var n=e.base,i=e.left,o=e.right,u=e.isInclusive;return a(this,void 0,void 0,(function(){var e,a,c,l;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return(e=s.sent()).isArray()?[4,e.get()]:[2,g];case 2:return a=s.sent(),l=o,(c=i)<0&&(c=a.length+c),l<0&&(l=a.length+l),u&&l++,c<0&&(c=0),l<0&&(l=0),[2,I(a.slice(c,l))]}}))}))},Deref:function(e,t,r){var n,i,o=e.base;return a(this,void 0,void 0,(function(){var e,a,u,l,p,f;return s(this,(function(s){switch(s.label){case 0:return[4,r(o,t)];case 1:if(e=s.sent(),!t.source.isArray())return[2,g];if("object"!==e.type)return[2,g];if("string"!==typeof(a=e.data._ref))return[2,g];s.label=2;case 2:s.trys.push([2,7,8,13]),u=c(t.source),s.label=3;case 3:return[4,u.next()];case 4:if((l=s.sent()).done)return[3,6];if("object"===(p=l.value).type&&a===p.data._id)return[2,p];s.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return f=s.sent(),n={error:f},[3,13];case 8:return s.trys.push([8,,11,12]),l&&!l.done&&(i=u.return)?[4,i.call(u)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,g]}}))}))},Value:function(e){return I(e.value)},Group:function(e,t,r){return r(e.base,t)},Object:function(e,t,r){var n=e.attributes;return a(this,void 0,void 0,(function(){var e,a,i,o,u,c,l,p,f;return s(this,(function(s){switch(s.label){case 0:e={},a=0,i=n,s.label=1;case 1:if(!(a<i.length))return[3,12];switch(o=i[a],u=o.type,o.type){case"ObjectAttributeValue":return[3,2];case"ObjectConditionalSplat":return[3,5];case"ObjectSplat":return[3,8]}return[3,10];case 2:return[4,r(o.value,t)];case 3:return f=s.sent(),c=e,l=o.name,[4,f.get()];case 4:return c[l]=s.sent(),[3,11];case 5:return[4,r(o.condition,t)];case 6:return"boolean"!==(p=s.sent()).type||!1===p.data?[3,11]:[4,r(o.value,t)];case 7:return"object"===(f=s.sent()).type&&Object.assign(e,f.data),[3,11];case 8:return[4,r(o.value,t)];case 9:return"object"===(f=s.sent()).type&&Object.assign(e,f.data),[3,11];case 10:throw new Error("Unknown node type: ".concat(u));case 11:return a++,[3,1];case 12:return[2,I(e)]}}))}))},Array:function(e,t,r){var n=e.elements;return new m((function(){return u(this,arguments,(function(){var e,a,i,u,l,p,f,h,d;return s(this,(function(s){switch(s.label){case 0:e=0,a=n,s.label=1;case 1:return e<a.length?(i=a[e],[4,o(r(i.value,t))]):[3,21];case 2:if(u=s.sent(),!i.isSplat)return[3,17];if(!u.isArray())return[3,16];s.label=3;case 3:s.trys.push([3,10,11,16]),h=void 0,l=c(u),s.label=4;case 4:return[4,o(l.next())];case 5:return(p=s.sent()).done?[3,9]:[4,o(p.value)];case 6:return[4,s.sent()];case 7:s.sent(),s.label=8;case 8:return[3,4];case 9:return[3,16];case 10:return f=s.sent(),h={error:f},[3,16];case 11:return s.trys.push([11,,14,15]),p&&!p.done&&(d=l.return)?[4,o(d.call(l))]:[3,13];case 12:s.sent(),s.label=13;case 13:return[3,15];case 14:if(h)throw h.error;return[7];case 15:return[7];case 16:return[3,20];case 17:return[4,o(u)];case 18:return[4,s.sent()];case 19:s.sent(),s.label=20;case 20:return e++,[3,1];case 21:return[2]}}))}))}))},Tuple:function(){throw new Error("tuples can not be evaluated")},Or:function(e,t,r){var n=e.left,i=e.right;return a(this,void 0,void 0,(function(){var e,a;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return e=s.sent(),[4,r(i,t)];case 2:return a=s.sent(),"boolean"===e.type&&!0===e.data||"boolean"===a.type&&!0===a.data?[2,k]:"boolean"!==e.type||"boolean"!==a.type?[2,g]:[2,x]}}))}))},And:function(e,t,r){var n=e.left,i=e.right;return a(this,void 0,void 0,(function(){var e,a;return s(this,(function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:return e=s.sent(),[4,r(i,t)];case 2:return a=s.sent(),"boolean"===e.type&&!1===e.data||"boolean"===a.type&&!1===a.data?[2,x]:"boolean"!==e.type||"boolean"!==a.type?[2,g]:[2,k]}}))}))},Not:function(e,t,r){var n=e.base;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return"boolean"!==(e=a.sent()).type?[2,g]:[2,e.data?x:k]}}))}))},Neg:function(e,t,r){return ze(r(e.base,t),(function(e){return"number"!==e.type?g:E(-e.data)}))},Pos:function(e,t,r){return ze(r(e.base,t),(function(e){return"number"!==e.type?g:E(e.data)}))},Asc:function(){return g},Desc:function(){return g},ArrayCoerce:function(e,t,r){var n=e.base;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return[2,(e=a.sent()).isArray()?e:g]}}))}))},Map:function(e,t,r){var n=e.base,i=e.expr;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return(e=a.sent()).isArray()?[2,new m((function(){return u(this,arguments,(function(){var n,a,u,l,p,f,h;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,8,9,14]),n=c(e),s.label=1;case 1:return[4,o(n.next())];case 2:return(a=s.sent()).done?[3,7]:(u=a.value,l=t.createHidden(u),[4,o(r(i,l))]);case 3:return[4,o.apply(void 0,[s.sent()])];case 4:return[4,s.sent()];case 5:s.sent(),s.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return p=s.sent(),f={error:p},[3,14];case 9:return s.trys.push([9,,12,13]),a&&!a.done&&(h=n.return)?[4,o(h.call(n))]:[3,11];case 10:s.sent(),s.label=11;case 11:return[3,13];case 12:if(f)throw f.error;return[7];case 13:return[7];case 14:return[2]}}))}))}))]:[2,g]}}))}))},FlatMap:function(e,t,r){var n=e.base,i=e.expr;return a(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return(e=a.sent()).isArray()?[2,new m((function(){return u(this,arguments,(function(){var n,a,u,l,p,f,h,d,y,b,v,m,w;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,23,24,29]),n=c(e),s.label=1;case 1:return[4,o(n.next())];case 2:return(a=s.sent()).done?[3,22]:(u=a.value,l=t.createHidden(u),[4,o(r(i,l))]);case 3:if(!(p=s.sent()).isArray())return[3,18];s.label=4;case 4:s.trys.push([4,11,12,17]),m=void 0,f=c(p),s.label=5;case 5:return[4,o(f.next())];case 6:return(h=s.sent()).done?[3,10]:[4,o(h.value)];case 7:return[4,s.sent()];case 8:s.sent(),s.label=9;case 9:return[3,5];case 10:return[3,17];case 11:return d=s.sent(),m={error:d},[3,17];case 12:return s.trys.push([12,,15,16]),h&&!h.done&&(w=f.return)?[4,o(w.call(f))]:[3,14];case 13:s.sent(),s.label=14;case 14:return[3,16];case 15:if(m)throw m.error;return[7];case 16:return[7];case 17:return[3,21];case 18:return[4,o(p)];case 19:return[4,s.sent()];case 20:s.sent(),s.label=21;case 21:return[3,1];case 22:return[3,29];case 23:return y=s.sent(),b={error:y},[3,29];case 24:return s.trys.push([24,,27,28]),a&&!a.done&&(v=n.return)?[4,o(v.call(n))]:[3,26];case 25:s.sent(),s.label=26;case 26:return[3,28];case 27:if(b)throw b.error;return[7];case 28:return[7];case 29:return[2]}}))}))}))]:[2,g]}}))}))}};function Je(e,t){void 0===t&&(t={});var r=I(t.root),a=I(t.dataset),s=n({},t.params);return Ze(e,new Re(s,a,r,{timestamp:t.timestamp||new Date,identity:void 0===t.identity?"me":t.identity,sanity:t.sanity,after:t.after?I(t.after):null,before:t.before?I(t.before):null},null))}function Qe(e){switch(e.type){case"Group":case"Value":case"Parameter":return!0;case"Pos":case"Neg":return Qe(e.base);case"OpCall":switch(e.op){case"+":case"-":case"*":case"/":case"%":case"**":return Qe(e.left)&&Qe(e.right);default:return!1}default:return!1}}var Le=new Re({},g,g,{timestamp:new Date(0),identity:"me",before:null,after:null},null);function Ye(e){return Qe(e)?Ke(e):null}function Ke(e){var t=Ze(e,Le,Ke);if("then"in t)throw new Error("BUG: constant evaluate should never return a promise");return t}var Xe={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function et(e){var t=parseInt(e,16);return String.fromCharCode(t)}var tt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="GroqQueryError",t}return r(t,e),t}(Error),rt={group:function(e){return{type:"Group",base:e.process(rt)}},everything:function(){return{type:"Everything"}},this:function(){return{type:"This"}},parent:function(){return{type:"Parent",n:1}},dblparent:function(e){return{type:"Parent",n:e.process(rt).n+1}},traverse:function(e){for(var t=e.process(rt),r=[];"traversal_end"!==e.getMark().name;)r.push(e.process(at));e.shift();for(var n=null,a=r.length-1;a>=0;a--)n=r[a](n);if("Everything"!==t.type&&"Array"!==t.type&&"PipeFuncCall"!==t.type||(n=Ve((function(e){return e}),n)),null===n)throw new Error("BUG: unexpected empty traversal");return n.build(t)},this_attr:function(e){var t=e.processString();return"null"===t?{type:"Value",value:null}:"true"===t?{type:"Value",value:!0}:"false"===t?{type:"Value",value:!1}:{type:"AccessAttribute",name:t}},neg:function(e){return{type:"Neg",base:e.process(rt)}},pos:function(e){return{type:"Pos",base:e.process(rt)}},add:function(e){return{type:"OpCall",op:"+",left:e.process(rt),right:e.process(rt)}},sub:function(e){return{type:"OpCall",op:"-",left:e.process(rt),right:e.process(rt)}},mul:function(e){return{type:"OpCall",op:"*",left:e.process(rt),right:e.process(rt)}},div:function(e){return{type:"OpCall",op:"/",left:e.process(rt),right:e.process(rt)}},mod:function(e){return{type:"OpCall",op:"%",left:e.process(rt),right:e.process(rt)}},pow:function(e){return{type:"OpCall",op:"**",left:e.process(rt),right:e.process(rt)}},comp:function(e){var t=e.process(rt);return{type:"OpCall",op:e.processString(),left:t,right:e.process(rt)}},in_range:function(e){var t=e.process(rt),r="inc_range"===e.getMark().name;return e.shift(),{type:"InRange",base:t,left:e.process(rt),right:e.process(rt),isInclusive:r}},str:function(e){var t="";e:for(;e.hasMark();){var r=e.getMark();switch(r.name){case"str_end":t+=e.processStringEnd();break e;case"str_pause":t+=e.processStringEnd();break;case"str_start":e.shift();break;case"single_escape":var n=e.slice(1);e.shift(),t+=Xe[n];break;case"unicode_hex":e.shift(),t+=et(e.processStringEnd());break;default:throw new Error("unexpected mark: ".concat(r.name))}}return{type:"Value",value:t}},integer:function(e){var t=e.processStringEnd();return{type:"Value",value:Number(t)}},float:function(e){var t=e.processStringEnd();return{type:"Value",value:Number(t)}},sci:function(e){var t=e.processStringEnd();return{type:"Value",value:Number(t)}},object:function(e){for(var t=[];"object_end"!==e.getMark().name;)t.push(e.process(nt));return e.shift(),{type:"Object",attributes:t}},array:function(e){for(var t=[];"array_end"!==e.getMark().name;){var r=!1;"array_splat"===e.getMark().name&&(r=!0,e.shift());var n=e.process(rt);t.push({type:"ArrayElement",value:n,isSplat:r})}return e.shift(),{type:"Array",elements:t}},tuple:function(e){for(var t=[];"tuple_end"!==e.getMark().name;)t.push(e.process(rt));return e.shift(),{type:"Tuple",members:t}},func_call:function(e){var t="global";"namespace"===e.getMark().name&&(e.shift(),t=e.processString());var r=e.processString();if("global"===t&&"select"===r){for(var n={type:"Select",alternatives:[]};"func_args_end"!==e.getMark().name;)if("pair"===e.getMark().name){if(n.fallback)throw new tt("unexpected argument to select()");e.shift();var a=e.process(rt),s=e.process(rt);n.alternatives.push({type:"SelectAlternative",condition:a,value:s})}else{if(n.fallback)throw new tt("unexpected argument to select()");s=e.process(rt),n.fallback=s}return e.shift(),n}for(var i=[];"func_args_end"!==e.getMark().name;)ut(t,r,i.length)?(e.process(st),i.push({type:"Selector"})):i.push(e.process(rt));if(e.shift(),"global"===t&&("before"===r||"after"===r)&&"delta"===e.parseOptions.mode)return{type:"Context",key:r};if("global"===t&&"boost"===r&&!e.allowBoost)throw new tt("unexpected boost");var o=ie[t];if(!o)throw new tt("Undefined namespace: ".concat(t));var u=o[r];if(!u)throw new tt("Undefined function: ".concat(r));if(void 0!==u.arity&&ot(r,u.arity,i.length),void 0!==u.mode&&u.mode!==e.parseOptions.mode)throw new tt("Undefined function: ".concat(r));return{type:"FuncCall",func:u,name:r,args:i}},pipecall:function(e){var t=e.process(rt);e.shift();var r="global";if("namespace"===e.getMark().name&&(e.shift(),r=e.processString()),"global"!==r)throw new tt("Undefined namespace: ".concat(r));var n=e.processString(),a=[],s=e.allowBoost;for("score"===n&&(e.allowBoost=!0);;){var i=e.getMark().name;if("func_args_end"===i)break;if("order"===n){if("asc"===i){e.shift(),a.push({type:"Asc",base:e.process(rt)});continue}if("desc"===i){e.shift(),a.push({type:"Desc",base:e.process(rt)});continue}}a.push(e.process(rt))}e.shift(),e.allowBoost=s;var o=re[n];if(!o)throw new tt("Undefined pipe function: ".concat(n));return o.arity&&ot(n,o.arity,a.length),{type:"PipeFuncCall",func:o,base:t,name:n,args:a}},pair:function(e){throw new tt("unexpected =>")},and:function(e){return{type:"And",left:e.process(rt),right:e.process(rt)}},or:function(e){return{type:"Or",left:e.process(rt),right:e.process(rt)}},not:function(e){return{type:"Not",base:e.process(rt)}},asc:function(e){throw new tt("unexpected asc")},desc:function(e){throw new tt("unexpected desc")},param:function(e){var t=e.processString();return e.parseOptions.params&&e.parseOptions.params.hasOwnProperty(t)?{type:"Value",value:e.parseOptions.params[t]}:{type:"Parameter",name:t}}},nt={object_expr:function(e){if("pair"===e.getMark().name)return e.shift(),{type:"ObjectConditionalSplat",condition:e.process(rt),value:e.process(rt)};var t=e.process(rt);return{type:"ObjectAttributeValue",name:it(t),value:t}},object_pair:function(e){var t=e.process(rt);if("Value"!==t.type)throw new Error("name must be string");var r=e.process(rt);return{type:"ObjectAttributeValue",name:t.value,value:r}},object_splat:function(e){return{type:"ObjectSplat",value:e.process(rt)}},object_splat_this:function(){return{type:"ObjectSplat",value:{type:"This"}}}},at={square_bracket:function(e){var t=e.process(rt),r=Ye(t);return r&&"number"===r.type?function(e){return Fe((function(e){return{type:"AccessElement",base:e,index:r.data}}),e)}:r&&"string"===r.type?function(e){return De((function(e){return{type:"AccessAttribute",base:e,name:r.data}}),e)}:function(e){return Ve((function(e){return{type:"Filter",base:e,expr:t}}),e)}},slice:function(e){var t="inc_range"===e.getMark().name;e.shift();var r=e.process(rt),n=e.process(rt),a=Ye(r),s=Ye(n);if(!a||!s||"number"!==a.type||"number"!==s.type)throw new tt("slicing must use constant numbers");return function(e){return Ve((function(e){return{type:"Slice",base:e,left:a.data,right:s.data,isInclusive:t}}),e)}},projection:function(e){var t=e.process(rt);return function(e){return qe((function(e){return{type:"Projection",base:e,expr:t}}),e)}},attr_access:function(e){var t=e.processString();return function(e){return De((function(e){return{type:"AccessAttribute",base:e,name:t}}),e)}},deref:function(e){var t=null;"deref_attr"===e.getMark().name&&(e.shift(),t=e.processString());var r=function(e){return t?{type:"AccessAttribute",base:e,name:t}:e};return function(e){return De((function(e){return r({type:"Deref",base:e})}),e)}},array_postfix:function(e){return function(e){return Ve((function(e){return{type:"ArrayCoerce",base:e}}),e)}}},st={group:function(e){return e.process(st),null},everything:function(){throw new Error("Invalid selector syntax")},this:function(){throw new Error("Invalid selector syntax")},parent:function(){throw new Error("Invalid selector syntax")},dblparent:function(e){throw new Error("Invalid selector syntax")},traverse:function(e){for(e.process(st);"traversal_end"!==e.getMark().name;)e.process(at);return e.shift(),null},this_attr:function(e){return e.processString(),null},neg:function(e){throw new Error("Invalid selector syntax")},pos:function(e){throw new Error("Invalid selector syntax")},add:function(e){throw new Error("Invalid selector syntax")},sub:function(e){throw new Error("Invalid selector syntax")},mul:function(e){throw new Error("Invalid selector syntax")},div:function(e){throw new Error("Invalid selector syntax")},mod:function(e){throw new Error("Invalid selector syntax")},pow:function(e){throw new Error("Invalid selector syntax")},comp:function(e){throw new Error("Invalid selector syntax")},in_range:function(e){throw new Error("Invalid selector syntax")},str:function(e){throw new Error("Invalid selector syntax")},integer:function(e){throw new Error("Invalid selector syntax")},float:function(e){throw new Error("Invalid selector syntax")},sci:function(e){throw new Error("Invalid selector syntax")},object:function(e){throw new Error("Invalid selector syntax")},array:function(e){throw new Error("Invalid selector syntax")},tuple:function(e){throw new Error("Invalid selector syntax")},func_call:function(e,t){var r=rt.func_call(e,t);if("anywhere"===r.name&&1===r.args.length)return null;throw new Error("Invalid selector syntax")},pipecall:function(e){throw new Error("Invalid selector syntax")},pair:function(e){throw new Error("Invalid selector syntax")},and:function(e){throw new Error("Invalid selector syntax")},or:function(e){throw new Error("Invalid selector syntax")},not:function(e){throw new Error("Invalid selector syntax")},asc:function(e){throw new Error("Invalid selector syntax")},desc:function(e){throw new Error("Invalid selector syntax")},param:function(e){throw new Error("Invalid selector syntax")}};function it(e){if("AccessAttribute"===e.type&&!e.base)return e.name;if("Deref"===e.type||"Map"===e.type||"Projection"===e.type||"Slice"===e.type||"Filter"===e.type||"AccessElement"===e.type||"ArrayCoerce"===e.type)return it(e.base);throw new tt("Cannot determine property key for type: ".concat(e.type))}function ot(e,t,r){if("number"===typeof t){if(r!==t)throw new tt("Incorrect number of arguments to function ".concat(e,"(). Expected ").concat(t,", got ").concat(r,"."))}else if(t&&!t(r))throw new tt("Incorrect number of arguments to function ".concat(e,"()."))}function ut(e,t,r){return"diff"==e&&2==r&&["changedAny","changedOnly"].includes(t)}var ct=function(e){function t(t){var r=e.call(this,"Syntax error in GROQ query at position ".concat(t))||this;return r.name="GroqSyntaxError",r.position=t,r}return r(t,e),t}(Error);function lt(e,t){void 0===t&&(t={});var r=Ee(e);if("error"===r.type)throw new ct(r.position);return new l(e,r.marks,t).process(rt)}e.evaluate=Je,e.parse=lt,Object.defineProperty(e,"__esModule",{value:!0})}(t)}}]);